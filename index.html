<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3786448290157661"
        crossorigin="anonymous"></script>
    <title>ç¾è‚¡ 7 å§å¦¹æ·±åº¦å›æµ‹ä¸å¯¹æ¯”ç³»ç»Ÿ - æ™ºç®—é‡‘è</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <style>
        :root {
            --primary: #38bdf8;
            --compare: #facc15;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --text-dim: #94a3b8;
            --up: #4ade80;
            --down: #f87171;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: var(--card);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .lang-switch {
            position: absolute;
            top: 20px;
            right: 30px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: #0f172a;
            color: var(--text-dim);
            border: 1px solid #475569;
            padding: 5px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: 0.3s;
        }

        .lang-btn.active {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(56, 189, 248, 0.1);
        }

        h1 {
            color: var(--primary);
            text-align: center;
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: 800;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .input-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-size: 11px;
            color: var(--text-dim);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input,
        select {
            padding: 12px;
            background: #0f172a;
            border: 1px solid #475569;
            color: white;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }

        button#runBtn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: #0f172a;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 18px;
            transition: 0.3s;
            margin-top: 10px;
        }

        button#runBtn:hover {
            background: #7dd3fc;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 189, 248, 0.4);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .stat-card {
            background: #334155;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #475569;
        }

        .stat-card h4 {
            margin: 0 0 10px 0;
            color: var(--text-dim);
            font-size: 12px;
        }

        .stat-card .value {
            font-size: 24px;
            color: var(--primary);
            font-weight: bold;
            display: block;
        }

        .stat-card .sub {
            font-size: 11px;
            color: #64748b;
            display: block;
            margin-top: 5px;
        }

        #chartWrapper {
            margin-top: 30px;
            background: #070b14;
            padding: 15px;
            border-radius: 12px;
            height: 450px;
            border: 1px solid #334155;
            position: relative;
            cursor: crosshair;
        }

        .reset-zoom-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            z-index: 10;
            background: rgba(51, 65, 85, 0.8);
            color: white;
            border: 1px solid #475569;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .table-container {
            margin-top: 40px;
            background: var(--card);
            border-radius: 12px;
            border: 1px solid #475569;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #475569;
            font-size: 14px;
        }

        th {
            background: #334155;
            color: var(--primary);
        }

        .seo-content {
            margin-top: 40px;
            padding: 30px;
            background: #0f172a;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            line-height: 1.8;
        }

        .report-link {
            text-decoration: none;
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #334155;
            text-align: center;
            transition: all 0.3s ease;
        }

        .report-link:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .site-footer {
            background-color: #1e293b;
            padding: 60px 20px;
            margin-top: 50px;
            border-top: 1px solid #334155;
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.8;
        }

        .site-footer a {
            color: var(--primary);
            text-decoration: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="lang-switch">
            <button class="lang-btn" onclick="setLang('en')" id="btn-en">English</button>
            <button class="lang-btn active" onclick="setLang('zh')" id="btn-zh">ä¸­æ–‡</button>
        </div>

        <h1 id="ui-title">ğŸ“Š ç¾è‚¡ 7 å§å¦¹æ·±åº¦å›æµ‹ä¸å¯¹æ¯”ç³»ç»Ÿ</h1>

        <div class="control-panel">
            <div class="input-item">
                <label id="ui-label-base">åŸºç¡€è‚¡ç¥¨ (ä¸»çº¿)</label>
                <select id="ticker" onchange="initYearOptions()">
                    <option value="NVDA">NVIDIA (NVDA)</option>
                    <option value="TSLA">Tesla (TSLA)</option>
                    <option value="AAPL">Apple (AAPL)</option>
                    <option value="MSFT">Microsoft (MSFT)</option>
                    <option value="GOOGL">Google (GOOGL)</option>
                    <option value="AMZN">Amazon (AMZN)</option>
                    <option value="META">Meta (META)</option>
                </select>
            </div>
            <div class="input-item">
                <label id="ui-label-compare">å¯¹æ¯”è‚¡ç¥¨ (è™šçº¿)</label>
                <select id="compareTicker">
                    <option value="none" id="ui-opt-none">-- ä¸å¯¹æ¯” --</option>
                    <option value="SPY">S&P 500 (SPY)</option>
                    <option value="NVDA">NVIDIA (NVDA)</option>
                    <option value="TSLA">Tesla (TSLA)</option>
                    <option value="AAPL">Apple (AAPL)</option>
                    <option value="MSFT">Microsoft (MSFT)</option>
                    <option value="GOOGL">Google (GOOGL)</option>
                    <option value="AMZN">Amazon (AMZN)</option>
                    <option value="META">Meta (META)</option>
                </select>
            </div>
            <div class="input-item">
                <label id="ui-label-capital">æœ¬é‡‘ ($)</label>
                <input type="number" id="capital" value="10000">
            </div>
            <div class="input-item">
                <label id="ui-label-start">å›æµ‹èµ·ç‚¹</label>
                <select id="startYear"></select>
            </div>
            <div class="input-item">
                <label id="ui-label-end">å›æµ‹ç»ˆç‚¹</label>
                <select id="endYear"></select>
            </div>
        </div>

        <button onclick="runAnalysis()" id="runBtn">ç”ŸæˆåŒºé—´å¯¹æ¯”å›æµ‹æŠ¥å‘Š</button>

        <div class="results-grid">
            <div class="stat-card">
                <h4 id="ui-stat-growth">ä¸»è‚¡ç´¯è®¡å¢é•¿</h4>
                <span id="resRate" class="value">0%</span>
                <span id="multiplierText" class="sub">èµ„äº§ç¿»äº† 0 å€</span>
            </div>
            <div class="stat-card">
                <h4 id="ui-stat-cagr">å¹´åŒ–æ”¶ç›Š (CAGR)</h4>
                <span id="resCAGR" class="value">0%</span>
                <span class="sub" id="ui-sub-cagr">å¤åˆå¹´å‡å¢é•¿ç‡</span>
            </div>
            <div class="stat-card">
                <h4 id="ui-stat-mdd">æœ€å¤§å›æ’¤ (MDD)</h4>
                <span id="resMDD" class="value" style="color: var(--down);">0%</span>
                <span class="sub" id="ui-sub-mdd">æœŸé—´æœ€å¤§äºæŸå¹…åº¦</span>
            </div>
            <div class="stat-card">
                <h4 id="ui-stat-final">æœ€ç»ˆèµ„äº§ä»·å€¼</h4>
                <span id="resFinal" class="value">$0</span>
                <span id="periodText" class="sub">ç»Ÿè®¡æ—¶é—´è·¨åº¦</span>
            </div>
        </div>

        <div id="chartWrapper">
            <button class="reset-zoom-btn" id="resetZoomBtn" onclick="resetZoom()">ğŸ”„ é‡ç½®è§†å›¾</button>
            <canvas id="chartCanvas"></canvas>
        </div>

        <div class="seo-content">
            <h3 id="ui-seo-h3">ğŸ¢ ç¾è‚¡â€œä¸ƒå§å¦¹â€æ·±åº¦å›æµ‹ä¸ä»·å€¼åˆ†æ</h3>
            <p id="ui-seo-p1">é€šè¿‡æœ¬å›æµ‹ç³»ç»Ÿï¼ŒæŠ•èµ„è€…å¯ä»¥æ·±åº¦åˆ†æè¿™ä¸ƒå®¶å·¨å¤´åœ¨ä¸åŒç»æµå‘¨æœŸä¸‹çš„éŸ§æ€§ä¸çˆ†å‘åŠ›å·®è·ã€‚</p>

            <div style="margin-top: 30px; border-top: 1px solid #334155; padding-top: 25px;">
                <h3 style="color: #facc15; margin-top: 0; margin-bottom: 20px;">
                    ğŸ“š æ·±åº¦ç ”æŠ¥ï¼šæ ¸å¿ƒèµ„äº§å…¨è§£æ (Deep Dive)
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px;">
                    <a href="pages/nvda.html" class="report-link">
                        <div style="font-weight: 900; font-size: 20px; color: #76b900;">NVDA</div>
                        <div style="font-size: 12px; color: #cbd5e1; margin-top: 5px;">AI ç®—åŠ›ä¹‹ç‹</div>
                        <div style="font-size: 11px; color: #64748b; margin-top: 8px;">æŸ¥çœ‹ç ”æŠ¥ â”</div>
                    </a>
                    <a href="pages/tsla.html" class="report-link">
                        <div style="font-weight: 900; font-size: 20px; color: #f87171;">TSLA</div>
                        <div style="font-size: 12px; color: #cbd5e1; margin-top: 5px;">èƒ½æºä¸æœºå™¨äºº</div>
                        <div style="font-size: 11px; color: #64748b; margin-top: 8px;">æŸ¥çœ‹ç ”æŠ¥ â”</div>
                    </a>
                    <a href="pages/aapl.html" class="report-link">
                        <div style="font-weight: 900; font-size: 20px; color: #94a3b8;">AAPL</div>
                        <div style="font-size: 12px; color: #cbd5e1; margin-top: 5px;">ç°é‡‘æµå¸å›½</div>
                        <div style="font-size: 11px; color: #64748b; margin-top: 8px;">æŸ¥çœ‹ç ”æŠ¥ â”</div>
                    </a>
                    <a href="pages/msft.html" class="report-link">
                        <div style="font-weight: 900; font-size: 20px; color: #0ea5e9;">MSFT</div>
                        <div style="font-size: 12px; color: #cbd5e1; margin-top: 5px;">äº‘ä¸ç”Ÿäº§åŠ›</div>
                        <div style="font-size: 11px; color: #64748b; margin-top: 8px;">æŸ¥çœ‹ç ”æŠ¥ â”</div>
                    </a>
                    <a href="pages/googl.html" class="report-link">
                        <div style="font-weight: 900; font-size: 20px; color: #3b82f6;">GOOGL</div>
                        <div style="font-size: 12px; color: #cbd5e1; margin-top: 5px;">å…¨çƒä¿¡æ¯å…¥å£</div>
                        <div style="font-size: 11px; color: #64748b; margin-top: 8px;">æŸ¥çœ‹ç ”æŠ¥ â”</div>
                    </a>
                    <a href="pages/amzn.html" class="report-link">
                        <div style="font-weight: 900; font-size: 20px; color: #f97316;">AMZN</div>
                        <div style="font-size: 12px; color: #cbd5e1; margin-top: 5px;">ç”µå•†ä¸äº‘åŸºå»º</div>
                        <div style="font-size: 11px; color: #64748b; margin-top: 8px;">æŸ¥çœ‹ç ”æŠ¥ â”</div>
                    </a>
                    <a href="pages/meta.html" class="report-link">
                        <div style="font-weight: 900; font-size: 20px; color: #06b6d4;">META</div>
                        <div style="font-size: 12px; color: #cbd5e1; margin-top: 5px;">ç¤¾äº¤ç½‘ç»œ</div>
                        <div style="font-size: 11px; color: #64748b; margin-top: 8px;">æŸ¥çœ‹ç ”æŠ¥ â”</div>
                    </a>
                    <a href="pages/spy.html" class="report-link">
                        <div style="font-weight: 900; font-size: 20px; color: #10b981;">SPY</div>
                        <div style="font-size: 12px; color: #cbd5e1; margin-top: 5px;">å¸‚åœºåŸºå‡†æŒ‡æ•°</div>
                        <div style="font-size: 11px; color: #64748b; margin-top: 8px;">æŸ¥çœ‹ç ”æŠ¥ â”</div>
                    </a>
                </div>
            </div>

            <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;" id="ui-seo-p2">ğŸ’¡ æ“æ§æŒ‡å—ï¼šä½¿ç”¨ é¼ æ ‡æ»šè½® æ”¾å¤§ç¼©å° X è½´ï¼›æŒ‰ä½
                é¼ æ ‡å·¦é”®å¹¶å·¦å³æ‹–åŠ¨ æµ‹é‡å±€éƒ¨æ¶¨å¹…ã€‚</p>
        </div>

        <div class="table-container">
            <h3 style="padding: 15px; margin: 0; background: #334155; font-size: 16px;" id="ui-table-title">ğŸ“… ä¸»è‚¡å¹´åº¦è¡¨ç°æ˜ç»†
            </h3>
            <table>
                <thead>
                    <tr id="ui-table-head">
                        <th>å¹´ä»½</th>
                        <th>å¹´åˆä»·æ ¼</th>
                        <th>å¹´æœ«ä»·æ ¼</th>
                        <th>å¹´åº¦æ¶¨è·Œå¹…</th>
                    </tr>
                </thead>
                <tbody id="yearlyTableBody"></tbody>
            </table>
        </div>
    </div>

    <footer class="site-footer">
        <div
            style="max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px;">
            <div>
                <h3 style="color: var(--primary); margin-top: 0;">About FinLogicHub5</h3>
                <p>Welcome to <strong>FinLogicHub5</strong>, a premier financial analytics destination.</p>
            </div>
            <div>
                <h3 style="color: var(--primary); margin-top: 0;">Resources & Legal</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 12px;"><a href="privacy.html">Privacy Policy / éšç§æ”¿ç­–</a></li>
                    <li style="margin-bottom: 12px;"><a href="disclaimer.html">Investment Disclaimer / å…è´£å£°æ˜</a></li>
                </ul>
                <p style="font-size: 12px; color: #64748b; margin-top: 30px;">
                    Â© 2026 FinLogicHub5. Beta Version 2.0 | Professional Data Structure
                </p>
            </div>
        </div>
    </footer>

    <script src="data.js"></script>
    <script>
        const langPack = {
            zh: {
                title: "ğŸ“Š ç¾è‚¡ 7 å§å¦¹æ·±åº¦å›æµ‹ä¸å¯¹æ¯”ç³»ç»Ÿ",
                labelBase: "åŸºç¡€è‚¡ç¥¨ (ä¸»çº¿)", labelCompare: "å¯¹æ¯”è‚¡ç¥¨ (è™šçº¿)", optNone: "-- ä¸å¯¹æ¯” --",
                labelCapital: "æœ¬é‡‘ ($)", labelStart: "å›æµ‹èµ·ç‚¹", labelEnd: "å›æµ‹ç»ˆç‚¹",
                btnRun: "ç”ŸæˆåŒºé—´å¯¹æ¯”å›æµ‹æŠ¥å‘Š", statGrowth: "ä¸»è‚¡ç´¯è®¡å¢é•¿", subMult: "èµ„äº§ç¿»äº† {x} å€",
                statCAGR: "å¹´åŒ–æ”¶ç›Š (CAGR)", subCAGR: "å¤åˆå¹´å‡å¢é•¿ç‡", statMDD: "æœ€å¤§å›æ’¤ (MDD)",
                subMDD: "æœŸé—´æœ€å¤§äºæŸå¹…åº¦", statFinal: "æœ€ç»ˆèµ„äº§ä»·å€¼", resetBtn: "ğŸ”„ é‡ç½®è§†å›¾",
                tableTitle: "ğŸ“… ä¸»è‚¡å¹´åº¦è¡¨ç°æ˜ç»†", tableHead: ["å¹´ä»½", "å¹´åˆä»·æ ¼", "å¹´æœ«ä»·æ ¼", "å¹´åº¦æ¶¨è·Œå¹…"],
                seoH3: "ğŸ¢ ç¾è‚¡â€œä¸ƒå§å¦¹â€(Magnificent Seven) æ·±åº¦æŠ•èµ„ä»·å€¼åˆ†æ",
                seoP1: "åœ¨å½“ä»Šå…¨çƒèµ„æœ¬å¸‚åœºä¸­ï¼Œç¾è‚¡â€œä¸ƒå§å¦¹â€ä¸ä»…ä»…æ˜¯ç§‘æŠ€å·¨å¤´ï¼Œæ›´æ˜¯å…¨çƒ AI é©å‘½çš„é¢†èˆªè€…ã€‚é€šè¿‡æœ¬å›æµ‹ç³»ç»Ÿï¼ŒæŠ•èµ„è€…å¯ä»¥æ·±åº¦å¤ç›˜è¿™äº›æ ¸å¿ƒèµ„äº§çš„è¡¨ç°ã€‚",
                seoP2: "ğŸ’¡ æ“æ§æŒ‡å—ï¼šä½¿ç”¨ é¼ æ ‡æ»šè½® æ”¾å¤§ç¼©å° X è½´ï¼›æŒ‰ä½ é¼ æ ‡å·¦é”®å¹¶å·¦å³æ‹–åŠ¨ å¯ç²¾å‡†æµ‹é‡ä»»æ„åŒºé—´çš„æ¶¨å¹…ã€‚",
                rulerTitle: "æ ¹Kçº¿åŒºé—´æ¶¨å¹…", toolDate: "ğŸ“… æ—¥æœŸ: ", toolChange: " è¾ƒèµ·ç‚¹"
            },
            en: {
                title: "ğŸ“Š Magnificent 7 Backtesting System",
                labelBase: "Primary Ticker", labelCompare: "Compare With", optNone: "-- No Compare --",
                labelCapital: "Initial Capital ($)", labelStart: "Start Year", labelEnd: "End Year",
                btnRun: "Generate Analytics Report", statGrowth: "Total Growth", subMult: "Portfolio up {x}x",
                statCAGR: "Annual Return (CAGR)", subCAGR: "Compound Annual Growth Rate", statMDD: "Max Drawdown (MDD)",
                subMDD: "Maximum peak-to-trough decline", statFinal: "Final Portfolio Value", resetBtn: "ğŸ”„ Reset Zoom",
                tableTitle: "ğŸ“… Annual Performance Details", tableHead: ["Year", "Start Price", "End Price", "Annual Change"],
                seoH3: "ğŸ¢ Strategic Analysis of the 'Magnificent Seven' Tech Giants",
                seoP1: "The 'Magnificent Seven' dictate the direction of the S&P 500. This system empowers investors to review these core assets with 10-year historical data.",
                seoP2: "ğŸ’¡ Guide: Use mouse wheel to zoom X-axis; hold Left Click & Drag to precisely measure performance.",
                rulerTitle: " K-lines Range Change", toolDate: "ğŸ“… Date: ", toolChange: " from start"
            }
        };

        let currentLang = 'zh';

        function setLang(lang) {
            currentLang = lang;
            const lp = langPack[lang];
            document.getElementById('ui-title').innerText = lp.title;
            document.getElementById('ui-label-base').innerText = lp.labelBase;
            document.getElementById('ui-label-compare').innerText = lp.labelCompare;
            document.getElementById('ui-opt-none').innerText = lp.optNone;
            document.getElementById('ui-label-capital').innerText = lp.labelCapital;
            document.getElementById('ui-label-start').innerText = lp.labelStart;
            document.getElementById('ui-label-end').innerText = lp.labelEnd;
            document.getElementById('runBtn').innerText = lp.btnRun;
            document.getElementById('ui-stat-growth').innerText = lp.statGrowth;
            document.getElementById('ui-stat-cagr').innerText = lp.statCAGR;
            document.getElementById('ui-sub-cagr').innerText = lp.subCAGR;
            document.getElementById('ui-stat-mdd').innerText = lp.statMDD;
            document.getElementById('ui-sub-mdd').innerText = lp.subMDD;
            document.getElementById('ui-stat-final').innerText = lp.statFinal;
            document.getElementById('resetZoomBtn').innerText = lp.resetBtn;
            document.getElementById('ui-table-title').innerText = lp.tableTitle;
            document.getElementById('ui-seo-h3').innerText = lp.seoH3;
            document.getElementById('ui-seo-p1').innerText = lp.seoP1;
            document.getElementById('ui-seo-p2').innerText = lp.seoP2;
            const headCells = document.getElementById('ui-table-head').cells;
            lp.tableHead.forEach((text, i) => headCells[i].innerText = text);
            document.getElementById('btn-zh').classList.toggle('active', lang === 'zh');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
            initYearOptions();
        }

        let isDragging = false, dragStartIdx = null, dragEndIdx = null;
        const rangeRulerPlugin = { id: 'rangeRuler', afterDraw: (chart) => { if (isDragging && dragStartIdx !== null && dragEndIdx !== null) { const { ctx, chartArea: { top, bottom }, scales: { x } } = chart; const xStart = x.getPixelForValue(dragStartIdx), xEnd = x.getPixelForValue(dragEndIdx); ctx.save(); ctx.fillStyle = 'rgba(56, 189, 248, 0.15)'; ctx.fillRect(xStart, top, xEnd - xStart, bottom - top); ctx.lineWidth = 1; ctx.strokeStyle = '#38bdf8'; ctx.setLineDash([5, 5]); ctx.beginPath(); ctx.moveTo(xStart, top); ctx.lineTo(xStart, bottom); ctx.moveTo(xEnd, top); ctx.lineTo(xEnd, bottom); ctx.stroke(); const results = [], kLines = Math.abs(dragEndIdx - dragStartIdx); chart.data.datasets.forEach((ds) => { const pS = ds.data[dragStartIdx], pE = ds.data[dragEndIdx]; if (pS && pE) { const pct = ((pE - pS) / pS * 100).toFixed(2); results.push({ label: `${ds.label.split(' ')[0]}: ${pct >= 0 ? '+' : ''}${pct}%`, color: ds.borderColor }); } }); ctx.setLineDash([]); ctx.font = 'bold 12px Arial'; const boxW = 160, boxH = (results.length * 20) + 35, lX = xEnd + boxW / 2 > chart.width ? xEnd - boxW / 2 : xEnd + boxW / 2, lY = top + 20; ctx.fillStyle = 'rgba(15, 23, 42, 0.9)'; ctx.fillRect(lX - boxW / 2, lY, boxW, boxH); ctx.fillStyle = '#94a3b8'; ctx.textAlign = 'center'; ctx.fillText(`${kLines}${langPack[currentLang].rulerTitle}`, lX, lY + 20); results.forEach((res, i) => { ctx.fillStyle = res.color; ctx.fillText(res.label, lX, lY + 40 + (i * 20)); }); ctx.restore(); } } };
        const crosshairPlugin = { id: 'crosshair', afterDraw: (chart) => { if (chart.tooltip?._active?.length) { const { ctx, chartArea: { top, bottom, left, right } } = chart; const activePoint = chart.tooltip._active[0]; const xCoor = activePoint.element.x, yCoor = activePoint.element.y; ctx.save(); ctx.beginPath(); ctx.lineWidth = 1; ctx.strokeStyle = 'rgba(148, 163, 184, 0.5)'; ctx.setLineDash([3, 3]); ctx.moveTo(xCoor, top); ctx.lineTo(xCoor, bottom); ctx.moveTo(left, yCoor); ctx.lineTo(right, yCoor); ctx.stroke(); ctx.restore(); } } };

        function initYearOptions() {
            const ticker = document.getElementById('ticker').value;
            const stockObj = STOCK_HISTORICAL_DATA[ticker];
            if (!stockObj) return;
            // âš ï¸ é€‚é…æ–°æ•°æ®ç»“æ„ï¼šä» dates æ•°ç»„æå–å¹´ä»½
            const years = [...new Set(stockObj.dates.map(d => d.split('-')[0].trim()))].sort();
            const sS = document.getElementById('startYear'), eS = document.getElementById('endYear');
            const sVal = sS.value, eVal = eS.value;
            sS.innerHTML = ""; eS.innerHTML = "";
            const startSuf = currentLang === 'zh' ? "å¹´åˆ" : " Start";
            const endSuf = currentLang === 'zh' ? "å¹´æœ«" : " End";
            years.forEach(yr => {
                sS.add(new Option(yr + startSuf, yr));
                eS.add(new Option(yr + endSuf, yr));
            });
            if (sVal) sS.value = sVal; else sS.selectedIndex = 0;
            if (eVal) eS.value = eVal; else eS.selectedIndex = years.length - 1;
        }

        function runAnalysis() {
            const ticker = document.getElementById('ticker').value, compTicker = document.getElementById('compareTicker').value;
            const cap = parseFloat(document.getElementById('capital').value);
            const sY = document.getElementById('startYear').value, eY = document.getElementById('endYear').value;
            if (sY > eY) return;

            // âš ï¸ é€‚é…æ–°æ•°æ®ç»“æ„
            const d1Obj = STOCK_HISTORICAL_DATA[ticker];
            const d2Obj = compTicker !== "none" ? STOCK_HISTORICAL_DATA[compTicker] : null;

            // è¿‡æ»¤æ—¥æœŸç´¢å¼•
            const startIndex = d1Obj.dates.findIndex(d => d.startsWith(sY));
            // æ‰¾ç»“æŸå¹´ä»½çš„æœ€åä¸€å¤©
            let endIndex = d1Obj.dates.length - 1;
            for (let i = d1Obj.dates.length - 1; i >= 0; i--) {
                if (d1Obj.dates[i].startsWith(eY)) { endIndex = i; break; }
            }

            // æˆªå–æ•°æ®
            const labels = d1Obj.dates.slice(startIndex, endIndex + 1);
            const data1 = d1Obj.prices.slice(startIndex, endIndex + 1);
            const data2 = d2Obj ? d2Obj.prices.slice(startIndex, endIndex + 1) : null;

            updateStats(data1, labels, cap);
            let ds = [{
                label: ticker,
                data: data1,
                borderColor: '#38bdf8',
                backgroundColor: 'rgba(56, 189, 248, 0.1)',
                borderWidth: 2, fill: true, pointRadius: 0, tension: 0.1, yAxisID: 'y'
            }];
            if (data2) ds.push({
                label: compTicker,
                data: data2,
                borderColor: '#facc15', borderDash: [5, 5], borderWidth: 2, fill: false, pointRadius: 0, tension: 0.1, yAxisID: 'y1'
            });
            drawChart(labels, ds, !!data2);
            updateYearlyTable(d1Obj, labels, data1);
        }

        function updateStats(data, labels, cap) {
            const sP = data[0], eP = data[data.length - 1];
            const growth = ((eP - sP) / sP) * 100, mult = eP / sP, yrs = labels.length / 252;
            const cagr = (Math.pow(mult, 1 / (yrs > 0 ? yrs : 1)) - 1) * 100;
            let maxP = 0, mdd = 0;
            data.forEach(p => { if (p > maxP) maxP = p; let dd = (p - maxP) / maxP; if (dd < mdd) mdd = dd; });
            document.getElementById('resRate').innerText = (growth >= 0 ? '+' : '') + growth.toFixed(2) + "%";
            document.getElementById('resRate').style.color = growth >= 0 ? "var(--up)" : "var(--down)";
            document.getElementById('multiplierText').innerText = langPack[currentLang].subMult.replace('{x}', mult.toFixed(1));
            document.getElementById('resCAGR').innerText = cagr.toFixed(2) + "%";
            document.getElementById('resMDD').innerText = (mdd * 100).toFixed(2) + "%";
            document.getElementById('resFinal').innerText = "$" + Math.round(cap * mult).toLocaleString();
            document.getElementById('periodText').innerText = `${labels[0]} to ${labels[labels.length - 1]}`;
        }

        function updateYearlyTable(stockObj, labels, prices) {
            const tbody = document.getElementById('yearlyTableBody');
            tbody.innerHTML = "";
            const years = [...new Set(labels.map(d => d.split('-')[0].trim()))].sort();

            // è¾…åŠ©å‡½æ•°ï¼šæ‰¾æŸå¹´åœ¨æˆªå–æ•°ç»„ä¸­çš„èµ·å§‹å’Œç»“æŸä»·æ ¼
            years.forEach(yr => {
                // æ‰¾åˆ°è¯¥å¹´ä»½åœ¨ labels ä¸­çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªç´¢å¼•
                const firstIdx = labels.findIndex(d => d.startsWith(yr));
                // æ‰¾åˆ°è¯¥å¹´ä»½åœ¨ labels ä¸­çš„æœ€åä¸€ä¸ªç´¢å¼•
                let lastIdx = -1;
                for (let i = labels.length - 1; i >= 0; i--) { if (labels[i].startsWith(yr)) { lastIdx = i; break; } }

                if (firstIdx !== -1 && lastIdx !== -1) {
                    const o = prices[firstIdx], c = prices[lastIdx], ch = ((c - o) / o) * 100;
                    tbody.innerHTML += `<tr><td><strong>${yr}</strong></td><td>$${o.toFixed(2)}</td><td>$${c.toFixed(2)}</td><td style="color:${ch >= 0 ? 'var(--up)' : 'var(--down)'}">${ch >= 0 ? '+' : ''}${ch.toFixed(2)}%</td></tr>`;
                }
            });
        }

        function resetZoom() { if (window.myChart) { window.myChart.resetZoom(); document.getElementById('resetZoomBtn').style.display = 'none'; } }

        function drawChart(labels, datasets, hasComp) {
            const ctx = document.getElementById('chartCanvas').getContext('2d');
            if (window.myChart) window.myChart.destroy();
            const bP1 = datasets[0].data[0], bP2 = hasComp ? datasets[1].data[0] : null;
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                plugins: [crosshairPlugin, rangeRulerPlugin],
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    onHover: (e, el) => { if (isDragging && el.length > 0) { dragEndIdx = el[0].index; window.myChart.draw(); } },
                    plugins: {
                        legend: { display: true, labels: { color: '#94a3b8' } },
                        tooltip: {
                            callbacks: {
                                title: (ctx) => langPack[currentLang].toolDate + ctx[0].label,
                                label: (ctx) => {
                                    if (isDragging) return null;
                                    const val = ctx.parsed.y, bP = ctx.datasetIndex === 0 ? bP1 : bP2;
                                    const ch = ((val - bP) / bP * 100).toFixed(2);
                                    return `${ctx.dataset.label}: $${val.toFixed(2)} (${ch >= 0 ? '+' : ''}${ch}%${langPack[currentLang].toolChange})`;
                                }
                            }
                        },
                        zoom: { zoom: { wheel: { enabled: true, speed: 0.1 }, mode: 'x', onZoomComplete: () => document.getElementById('resetZoomBtn').style.display = 'block' }, pan: { enabled: true, mode: 'x' } }
                    },
                    scales: {
                        x: { ticks: { color: '#94a3b8', maxTicksLimit: 10 }, grid: { display: false } },
                        y: { type: 'linear', position: 'left', ticks: { color: '#38bdf8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                        y1: { type: 'linear', display: hasComp, position: 'right', ticks: { color: '#facc15' }, grid: { display: false } }
                    }
                }
            });
            const canvas = document.getElementById('chartCanvas');
            canvas.onmousedown = (e) => { const pts = window.myChart.getElementsAtEventForMode(e, 'index', { intersect: false }, true); if (pts.length > 0) { isDragging = true; dragStartIdx = pts[0].index; dragEndIdx = dragStartIdx; } };
            window.onmouseup = () => { isDragging = false; dragStartIdx = null; dragEndIdx = null; if (window.myChart) window.myChart.draw(); };
        }

        window.onload = () => { setLang('zh'); };
        window.addEventListener('load', function () {
            const tickerSelect = document.getElementById('ticker');
            const compareSelect = document.getElementById('compareTicker');
            if (tickerSelect) tickerSelect.value = "NVDA";
            if (compareSelect) compareSelect.value = "SPY";
            setTimeout(() => { runAnalysis(); }, 600);
        });
    </script>

    <script>
        (function () {
            const extLang = {
                zh: { tab: "ğŸ’Š åæ‚”è¯è®¡ç®—å™¨", title: "ğŸ’Š å¦‚æœå½“åˆ...", labelTicker: "å‡å¦‚æˆ‘ä¹°äº†è¿™åªè‚¡", labelStart: "ä»å“ªä¸€å¹´å¼€å§‹", labelEnd: "åˆ°å“ªä¸€å¹´ä¸ºæ­¢", labelCap: "åˆå§‹æŠ•å…¥é‡‘é¢ ($)", labelDca: "ä¹‹åæ¯æœˆè¿½åŠ  ($)", btnCalc: "åä¸‹è¿™é¢—åæ‚”è¯", btnClose: "â® é—­çœ¼æ”¶èµ·", resFinal: "ç°åœ¨çš„èº«ä»·:", resRank: "è´¢å¯Œç­‰çº§:", factPrefix: "ğŸ˜± æ‰å¿ƒäº†ï¼å¦‚æœä¸ä¹°æ¶ˆè´¹å“æ”¹ä¹° {t}ï¼Œè¿™ç¬”é’±ç°åœ¨å¤Ÿä½ åœ¨éƒŠåŒºä»˜ {n} ä¸ªæˆ¿å­çš„é¦–ä»˜äº†ã€‚", ranks: ["ç†è´¢å°ç™½", "èµ„æ·±æ‰“å·¥äºº", "è´¢åŠ¡è‡ªç”±å…¥é—¨", "äº¿ä¸‡å¯Œç¿é¢„å¤‡å½¹"] },
                en: { tab: "ğŸ’Š Regret Medicine", title: "ğŸ’Š What If...", labelTicker: "If I bought this stock", labelStart: "Start Year", labelEnd: "End Year", labelCap: "Initial Investment ($)", labelDca: "Monthly DCA ($)", btnCalc: "Take the Regret Pill", btnClose: "â® Close Eyes", resFinal: "Current Net Worth:", resRank: "Wealth Level:", factPrefix: "ğŸ˜± Ouch! If you skip coffee and bought {t}, this money could pay for {n} house down payments now.", ranks: ["Novice", "Senior Pro", "Financial Freedom", "Future Billionaire"] }
            };
            const style = document.createElement('style');
            style.innerHTML = `#independent-dca-calculator { position: fixed; left: 0; top: 50%; transform: translateY(-50%); width: 280px; background: #1a1c2e; border: 2px solid #facc15; border-left: none; border-radius: 0 15px 15px 0; padding: 20px; box-shadow: 10px 0 50px rgba(250, 204, 21, 0.2); z-index: 10000; font-family: 'Segoe UI', sans-serif; color: #f8fafc; transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1); } #independent-dca-calculator.collapsed { left: -280px; } #dca-toggle-btn { position: absolute; right: -40px; top: 50%; transform: translateY(-50%); width: 38px; height: 150px; background: linear-gradient(180deg, #facc15, #fb923c); border-radius: 0 10px 10px 0; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #1e293b; font-weight: 900; font-size: 14px; writing-mode: vertical-rl; text-orientation: mixed; box-shadow: 0 0 15px rgba(250, 204, 21, 0.5); animation: goldBreath 2s infinite ease-in-out; letter-spacing: 2px; } @keyframes goldBreath { 0% { box-shadow: 0 0 0 0px rgba(250, 204, 21, 0.7); filter: brightness(1); } 50% { box-shadow: 0 0 25px 12px rgba(250, 204, 21, 0); filter: brightness(1.3); } 100% { box-shadow: 0 0 0 0px rgba(250, 204, 21, 0.7); filter: brightness(1); } } .dca-title { color: #facc15; font-weight: 900; margin-bottom: 15px; font-size: 18px; text-align: center; border-bottom: 1px solid #334155; padding-bottom: 10px; } .dca-field { margin-bottom: 12px; } .dca-field label { display: block; font-size: 11px; color: #94a3b8; margin-bottom: 4px; font-weight: bold; } .dca-field input, .dca-field select { width: 100%; box-sizing: border-box; padding: 10px; background: #0f172a; border: 1px solid #475569; color: #facc15; border-radius: 8px; font-size: 14px; outline: none; } .dca-btn { width: 100%; padding: 14px; background: linear-gradient(90deg, #facc15, #fb923c); color: #0f172a; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; transition: 0.3s; font-size: 15px; margin-top: 10px; } .dca-res-card { margin-top: 15px; padding: 15px; background: rgba(250, 204, 21, 0.05); border-radius: 10px; border: 1px solid rgba(250, 204, 21, 0.2); display: none; } .res-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; } .res-val { font-weight: bold; color: #facc15; } @media (max-width: 1000px) { #independent-dca-calculator { display: none; } }`;
            document.head.appendChild(style);
            const dcaUI = document.createElement('div');
            dcaUI.id = 'independent-dca-calculator'; dcaUI.className = 'collapsed';
            dcaUI.innerHTML = `<div id="dca-toggle-btn">ğŸ’Š åæ‚”è¯è®¡ç®—å™¨</div><div class="dca-title" id="ext-ui-title">ğŸ’Š å¦‚æœå½“åˆ...</div><div class="dca-field"><label id="ext-ui-ticker">å‡å¦‚æˆ‘ä¹°äº†è¿™åªè‚¡</label><select id="ext-ticker"><option value="NVDA">NVIDIA (NVDA)</option><option value="TSLA">Tesla (TSLA)</option><option value="AAPL">Apple (AAPL)</option><option value="MSFT">Microsoft (MSFT)</option><option value="GOOGL">Google (GOOGL)</option><option value="AMZN">Amazon (AMZN)</option><option value="META">Meta (META)</option><option value="SPY">S&P 500 (SPY)</option></select></div><div style="display:flex; gap:10px;"><div class="dca-field" style="flex:1;"><label id="ext-ui-start">ä»å“ªä¸€å¹´å¼€å§‹</label><select id="ext-start"></select></div><div class="dca-field" style="flex:1;"><label id="ext-ui-end">åˆ°å“ªä¸€å¹´ä¸ºæ­¢</label><select id="ext-end"></select></div></div><div class="dca-field"><label id="ext-ui-cap">åˆå§‹æŠ•å…¥é‡‘é¢ ($)</label><input type="number" id="ext-capital" value="10000"></div><div class="dca-field"><label id="ext-ui-dca">ä¹‹åæ¯æœˆè¿½åŠ  ($)</label><input type="number" id="ext-dca" value="500"></div><button class="dca-btn" id="ext-calc-btn">åä¸‹è¿™é¢—åæ‚”è¯</button><div class="dca-res-card" id="ext-res-display"><div class="res-line"><span id="ext-ui-res-final">ç°åœ¨çš„èº«ä»·:</span> <span class="res-val" id="ext-final-val">$0</span></div><div class="res-line"><span id="ext-ui-res-rank">è´¢å¯Œç­‰çº§:</span> <span id="ext-rank" style="font-weight:bold; color:#4ade80;">-</span></div><hr style="border:0; border-top:1px solid #334155; margin:10px 0;"><div id="ext-fun-fact" style="font-size:11px; color:#fb923c; font-style:italic;"></div></div>`;
            document.body.appendChild(dcaUI);
            function refreshExtLang() { const lang = (typeof currentLang !== 'undefined') ? currentLang : 'zh'; const lp = extLang[lang]; document.getElementById('dca-toggle-btn').innerText = dcaUI.classList.contains('collapsed') ? lp.tab : lp.btnClose; document.getElementById('ext-ui-title').innerText = lp.title; document.getElementById('ext-ui-ticker').innerText = lp.labelTicker; document.getElementById('ext-ui-start').innerText = lp.labelStart; document.getElementById('ext-ui-end').innerText = lp.labelEnd; document.getElementById('ext-ui-cap').innerText = lp.labelCap; document.getElementById('ext-ui-dca').innerText = lp.labelDca; document.getElementById('ext-calc-btn').innerText = lp.btnRun || lp.btnCalc; document.getElementById('ext-ui-res-final').innerText = lp.resFinal; document.getElementById('ext-ui-res-rank').innerText = lp.resRank; if (document.getElementById('ext-res-display').style.display === 'block') { const ev = new Event('click'); document.getElementById('ext-calc-btn').dispatchEvent(ev); } }
            document.getElementById('ext-calc-btn').addEventListener('click', function () {
                const lang = (typeof currentLang !== 'undefined') ? currentLang : 'zh';
                const lp = extLang[lang];
                const ticker = document.getElementById('ext-ticker').value;
                const sY = document.getElementById('ext-start').value;
                const eY = document.getElementById('ext-end').value;
                const cap = parseFloat(document.getElementById('ext-capital').value) || 0;
                const dca = parseFloat(document.getElementById('ext-dca').value) || 0;
                if (typeof STOCK_HISTORICAL_DATA === 'undefined') return;

                // âš ï¸ é€‚é…æ–°æ•°æ®ç»“æ„
                const stockObj = STOCK_HISTORICAL_DATA[ticker];
                // è¿‡æ»¤æ—¥æœŸ
                const indices = stockObj.dates.map((d, i) => (d.startsWith(sY) || d >= sY) && (d.startsWith(eY) || d <= eY) ? i : -1).filter(i => i !== -1);

                if (indices.length === 0) return;

                const prices = stockObj.prices;
                const dates = stockObj.dates;

                // è®¡ç®—é€»è¾‘
                let shares = cap / prices[indices[0]];
                let invested = cap;
                let lastM = dates[indices[0]].split('-')[1];

                for (let i = 1; i < indices.length; i++) {
                    const idx = indices[i];
                    if (dates[idx].split('-')[1] !== lastM) {
                        shares += dca / prices[idx];
                        invested += dca;
                        lastM = dates[idx].split('-')[1];
                    }
                }
                const final = shares * prices[indices[indices.length - 1]];

                const multiplier = final / invested; let rankIdx = 0; if (multiplier > 10) rankIdx = 3; else if (multiplier > 5) rankIdx = 2; else if (multiplier > 2) rankIdx = 1; document.getElementById('ext-res-display').style.display = 'block'; document.getElementById('ext-final-val').innerText = "$" + Math.round(final).toLocaleString(); document.getElementById('ext-rank').innerText = lp.ranks[rankIdx]; const houseDownPayments = (final / 250000).toFixed(1); document.getElementById('ext-fun-fact').innerText = lp.factPrefix.replace('{t}', ticker).replace('{n}', houseDownPayments);
            });
            document.getElementById('dca-toggle-btn').addEventListener('click', () => { dcaUI.classList.toggle('collapsed'); refreshExtLang(); });
            const originalSetLang = window.setLang; window.setLang = function (lang) { if (typeof originalSetLang === 'function') originalSetLang(lang); setTimeout(refreshExtLang, 50); };
            function initExtYears() {
                const start = document.getElementById('ext-start');
                const end = document.getElementById('ext-end');
                if (typeof STOCK_HISTORICAL_DATA !== 'undefined') {
                    // é€‚é… NVDA çš„ dates æ•°ç»„
                    const stockObj = STOCK_HISTORICAL_DATA["NVDA"];
                    if (!stockObj) return;
                    const years = [...new Set(stockObj.dates.map(d => d.split('-')[0].trim()))].sort();
                    years.forEach(yr => { start.add(new Option(yr, yr)); end.add(new Option(yr, yr)); });
                    start.value = "2016"; end.value = years[years.length - 1];
                }
            }
            window.addEventListener('load', () => { initExtYears(); setTimeout(refreshExtLang, 100); });
        })();
    </script>
</body>

</html>